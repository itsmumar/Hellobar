<script type="text/javascript">

  $(function () {

    function initializeFields(stylesName, styles) {
      function initializeField(propertyName) {
        var $field = $('[data-styles="' + stylesName + '"][data-property="' + propertyName + '"]');
        $field.val(styles[propertyName]);
      }
      for (var propertyName in styles) {
        styles.hasOwnProperty(propertyName) && initializeField(propertyName);
      }
    }

    var defaultOfferModel = {
      headline: 'Content Upgrade Offer Headline'
    };
    var offerStyles = {
      offerBackgroundColor: '<%= @styles['offer_bg_color'] || '#504157' %>',
      offerBorderColor: '#ffd219',
      offerBorderWidth: '1px',
      offerBorderStyle: 'none',
      offerBorderRadius: '0px'
    };
    var $offerPreview = $('.js-offer-preview-container').contentUpgradeOfferPreview({
      defaultModel: defaultOfferModel,
      defaultStyles: offerStyles
    });

    var defaultModalModel = {
      caption: 'Almost there! Please fill in this form and click the button below to gain access',
      headline: 'Enter your details to download cheatsheet of 10 useful tools to craft beautiful graphics for social media',
      cta: 'Download Now >>',
      spamDisclaimer: 'We hate SPAM and promise to keep your email address safe'
    };
    var modalStyles = {
      modalBackgroundColor: '<%= @styles['modal_bg_color'] || '#404157' %>',
      modalBorderColor: '#404157',
      modalBorderWidth: '1px',
      modalBorderStyle: 'none',
      modalBorderRadius: '0px'
    };
    var $modalPreview = $('.js-modal-preview-container').contentUpgradeModalPreview({
      defaultModel: defaultModalModel
    });

    $('[data-property]').on('change', function(evt) {
      var $field = $(evt.currentTarget);
      function stylesObject() {
        return $field.attr('data-styles') === 'offer' ? offerStyles : modalStyles;
      }
      function updatePreview(styles) {
        return $field.attr('data-styles') === 'offer' ?
                $offerPreview.contentUpgradeOfferPreview('update', null, styles) :
                $modalPreview.contentUpgradeModalPreview('update', null, styles);
      }
      var styles = stylesObject();
      styles[$field.attr('data-property')] = $field.val();
      updatePreview(styles);
    });

    initializeFields('offer', offerStyles);
    initializeFields('modal', modalStyles);

  });

</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.js" type="text/javascript"></script>
<style type="text/css">
  @import url("//cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css");
</style>

<h2>Style Editor</h2>


<%= form_tag update_styles_site_content_upgrades_path(@site.id), method: "post" do %>

<% end %>

<%= form_tag(update_styles_site_content_upgrades_path(@site.id))%>
  <div class="content-upgrade-form">

    <div class="columns">
      <div class="form-column">

        <h3>Offer Headline</h3>

        <div class="field-wrapper">
          <label for="offer-background-color">Background Color</label>
          <input name="offer_bg_color" id="offer-background-color" type="color" class="js-color-picker-field color-picker-field"
                 value="<%= @styles['offer_bg_color'] || '#504157' %>"  data-property="offerBackgroundColor" data-styles="offer">
        </div>

        <div class="field-wrapper">
          <label for="offer-border-color">Border Color</label>
          <input name="offer_border_color" id="offer-border-color" type="color" class="js-color-picker-field color-picker-field"
                 value="#404157" data-property="offerBorderColor" data-styles="offer">
        </div>

        <div class="select-wrapper">
          <label for="offer-border-width">Border Thickness</label>
          <select id="offer-border-width" data-property="offerBorderWidth" data-styles="offer">
            <option value="1px">1px</option>
            <option value="2px">2px</option>
            <option value="3px">3px</option>
          </select>
        </div>

        <div class="select-wrapper">
          <label for="offer-border-style">Border Style</label>
          <select id="offer-border-style" data-property="offerBorderStyle" data-styles="offer">
            <option value="none">None</option>
            <option value="solid">Solid</option>
            <option value="dotted">Dotted</option>
            <option value="dashed">Dashed</option>
          </select>
        </div>

        <div class="select-wrapper">
          <label for="offer-border-radius">Border Radius</label>
          <select id="offer-border-radius" data-property="offerBorderRadius" data-styles="offer">
            <option value="0px">0px</option>
            <option value="1px">1px</option>
            <option value="2px">2px</option>
            <option value="3px">3px</option>
            <option value="4px">4px</option>
            <option value="5px">5px</option>
          </select>
        </div>


        <h3>Modal Elements</h3>

        <div class="field-wrapper">
          <label for="modal-background-color">Progress Color</label>
          <input name="modal_bg_color" id="modal-background-color" type="color" class="js-color-picker-field color-picker-field"
                 value="<%= @styles['modal_bg_color'] || '#404157' %>" data-property="modalBackgroundColor" data-styles="modal">
        </div>

        <div class="field-wrapper">
          <label for="modal-background-color">Background Color</label>
          <input name="modal_bg_color" id="modal-background-color" type="color" class="js-color-picker-field color-picker-field"
                 value="<%= @styles['modal_bg_color'] || '#404157' %>" data-property="modalBackgroundColor" data-styles="modal">
        </div>

        <div class="field-wrapper">
          <label for="modal-border-color">Border Color</label>
          <input id="modal-border-color" type="color" class="js-color-picker-field color-picker-field"
                 value="#404157" data-property="modalBorderColor" data-styles="modal">
        </div>

        <div class="select-wrapper">
          <label for="modal-border-width">Border Thickness</label>
          <select id="modal-border-width" data-property="modalBorderWidth" data-styles="modal">
            <option value="1px">1px</option>
            <option value="2px">2px</option>
            <option value="3px">3px</option>
          </select>
        </div>

        <div class="select-wrapper">
          <label for="modal-border-style">Border Style</label>
          <select id="modal-border-style" data-property="modalBorderStyle" data-styles="modal">
            <option value="none">None</option>
            <option value="solid">Solid</option>
            <option value="dotted">Dotted</option>
            <option value="dashed">Dashed</option>
          </select>
        </div>

        <div class="select-wrapper">
          <label for="modal-border-radius">Border Radius</label>
          <select id="modal-border-radius" data-property="modalBorderRadius" data-styles="modal">
            <option value="0px">0px</option>
            <option value="1px">1px</option>
            <option value="2px">2px</option>
            <option value="3px">3px</option>
            <option value="4px">4px</option>
            <option value="5px">5px</option>
          </select>
        </div>

      </div>

      <div class="preview-column">
        <h3>Content Upgrade Offer</h3>

        <div class="js-offer-preview-container preview-container"></div>
        <h3>Content Upgrade Modal</h3>

        <div class="js-modal-preview-container preview-container"></div>
      </div>
    </div>

    <div class="buttons">
      <input type="submit" class="save" value="Save">
      <%= link_to('List', site_content_upgrades_path(@site.id), :class => "list") %>
    </div>

  </div>

</form>
