<script type="text/javascript">

  $(function () {
    function setPlaceholder(elementId, placeholder) {
      $('#' + elementId).attr('placeholder', placeholder);
    }

    function initializeFroala() {
      var froalaKey = 'Qg1Ti1LXd2URVJh1DWXG==';
      $('#content-edit').froalaEditor({
        key: froalaKey
      });
    }

    var defaultOfferModel = {
      headline: 'Content Upgrade Offer Headline'
    };
    var offerModel = {
      headline: ''
    };
    var $offerPreview = $('.js-offer-preview-container').contentUpgradeOfferPreview({
      defaultModel: defaultOfferModel
    });
    $('#offer-headline').attr('placeholder', defaultOfferModel.headline).on('keydown', function (evt) {
      setTimeout(function () {
        offerModel.headline = $(evt.currentTarget).val();
        $offerPreview.contentUpgradeOfferPreview('update', offerModel);
      });
    });

    var defaultModalModel = {
      caption: 'Almost there! Please fill in this form and click the button below to gain access',
      headline: 'Enter your details to download cheatsheet of 10 useful tools to craft beautiful graphics for social media',
      cta: 'Download Now >>',
      spamDisclaimer: 'We hate SPAM and promise to keep your email address safe'
    };
    var modalModel = {
      caption: '',
      headline: '',
      cta: '',
      spamDisclaimer: ''
    };
    var $modalPreview = $('.js-modal-preview-container').contentUpgradeModalPreview({
      defaultModel: defaultModalModel
    });
    $('.js-modal-input[data-property]').each(function () {
      var $this = $(this);
      setPlaceholder($this.attr('id'), defaultModalModel[$this.attr('data-property')]);
    }).on('keydown', function (evt) {
      var $this = $(this);
      setTimeout(function () {
        modalModel[$this.attr('data-property')] = $(evt.currentTarget).val();
        $modalPreview.contentUpgradeModalPreview('update', modalModel);
      }, 1);
    });

    initializeFroala();

  });
</script>

<!-- TODO Discuss if we can apply better approach to include Froala (Gems or something like that) -->
<style>
@import url("//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css");
@import url("//cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/codemirror.min.css");
@import url("//cdnjs.cloudflare.com/ajax/libs/froala-editor/2.3.5/css/froala_style.min.css");
@import url("//cdnjs.cloudflare.com/ajax/libs/froala-editor/2.3.5/css/froala_editor.pkgd.min.css");
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/froala-editor/2.3.5/js/froala_editor.pkgd.min.js" type="text/javascript"></script>

  <div class="content-upgrade-form">

    <div class="columns">
      <div class="form-column">

        <h3>Offer Headline</h3>

        <div class="field-wrapper">
          <label for="offer-headline">Your link should look like {{link text}}</label>
          <input name="offer_headline" id="offer-headline" type="text" data-property="headline" value="<%= @content_upgrade.offer_headline %>">
        </div>

        <h3>Modal Elements</h3>

        <div class="field-wrapper">
          <label for="caption">Caption Text</label>
          <input name="caption" id="caption" type="text" class="js-modal-input" data-property="caption" value="<%= @content_upgrade.caption %>">
        </div>

        <div class="field-wrapper">
          <label for="headline">Headline Text</label>
          <input name="headline" id="headline" type="text" class="js-modal-input" data-property="headline"  value="<%= @content_upgrade.headline %>">
        </div>

        <div class="field-wrapper">
          <label for="name-placeholder">Name Placeholder</label>
          <input name="name_placeholder"  id="name-placeholder" type="text" class="js-modal-input" data-property="namePlaceholder"  value="<%= @content_upgrade.name_placeholder %>">
        </div>

        <div class="field-wrapper">
          <label for="email-placeholder">Email Placeholder</label>
          <input name="email_placeholder"  id="email-placeholder" type="text" class="js-modal-input" data-property="emailPlaceholder"  value="<%= @content_upgrade.email_placeholder %>">
        </div>

        <div class="field-wrapper">
          <label for="cta">Button Text</label>
          <input name="button_text"  id="cta" type="text" class="js-modal-input" data-property="cta"  value="<%= @content_upgrade.link_text %>">
        </div>

        <div class="field-wrapper">
          <label for="spam-disclaimer">Spam Disclaimer</label>
          <input name="disclaimer"  id="spam-disclaimer" type="text" class="js-modal-input" data-property="spamDisclaimer"  value="<%= @content_upgrade.disclaimer %>">
        </div>


        <h3>Choose Content</h3>

        <div class="select-wrapper">
          <label for="existing-content">Content Made in HelloBar</label>
          <select id="existing-content">
            <option value="">Select content...</option>
            <option value="1">Content 1</option>
            <option value="2">Content 2</option>
          </select>
        </div>

      </div>

      <div class="preview-column">
        <h3>Content Upgrade Offer</h3>

        <div class="js-offer-preview-container preview-container"></div>
        <h3>Content Upgrade Modal</h3>

        <div class="js-modal-preview-container preview-container"></div>
      </div>
    </div>

    <div class="js-froala-editor-container">
      <textarea id="content-edit" name="content"><%= @content_upgrade.content %></textarea>
    </div>

    <div class="buttons">
      <input type="submit" class="save" value="Save">
      <%= link_to('List', site_content_upgrades_path(@site.id), :class => "list") %>
    </div>

  </div>
