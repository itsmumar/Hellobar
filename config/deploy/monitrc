set daemon 30

set httpd port 4000 and
    use address 0.0.0.0
    allow admin:"34v02#2dmvaz21"

set logfile /mnt/deploy/shared/log/monit.log

check process guaranteed_queue with pidfile /mnt/deploy/shared/pids/guaranteed_queue.pid
        start program = "/bin/bash -c 'HOME=/home/hellobar cd /mnt/deploy/current; PATH=/usr/local/bin:$PATH RAILS_ENV=production GUARANTEED_QUEUE_NAME=hellobar3_production bundle exec ./bin/load_env guaranteed_queue start --pidfile=/mnt/deploy/shared/pids/guaranteed_queue.pid'"
        stop program = "/bin/bash -c 'HOME=/home/hellobar cd /mnt/deploy/current && PATH=/usr/local/bin:$PATH RAILS_ENV=production bundle exec ./bin/load_env guaranteed_queue stop --pidfile=/mnt/deploy/shared/pids/guaranteed_queue.pid'"
        if cpu usage > 95% for 10 cycles then restart

check process guaranteed_queue_lowpriority with pidfile /mnt/deploy/shared/pids/guaranteed_queue.lowpriority.pid
        start program = "/bin/bash -c 'HOME=/home/hellobar cd /mnt/deploy/current; PATH=/usr/local/bin:$PATH RAILS_ENV=production GUARANTEED_QUEUE_NAME=hellobar3_production bundle exec ./bin/load_env guaranteed_queue start --pidfile=/mnt/deploy/shared/pids/guaranteed_queue.lowpriority.pid'"
        stop program = "/bin/bash -c 'HOME=/home/hellobar cd /mnt/deploy/current && PATH=/usr/local/bin:$PATH RAILS_ENV=production bundle exec ./bin/load_env guaranteed_queue stop --pidfile=/mnt/deploy/shared/pids/guaranteed_queue.lowpriority.pid'"
        if cpu usage > 95% for 10 cycles then restart
