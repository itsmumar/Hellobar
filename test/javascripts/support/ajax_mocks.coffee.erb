$.mockjaxSettings.logging = false

$.mockjax
  url: /^\/sites\/([\d]+)\/site_elements\/([\d\-]+)\.json$/
  urlParams: ['siteID', 'siteElementID']
  contentType: 'text/json'
  response: (settings) ->
    <%
      site = Site.new(script_installed_at: Time.now)
      element = site.site_elements.new
      rule = Rule.new(:site => site)
      element.rule = rule
    %>
    siteElement = <%= SiteElementSerializer.new(element).to_json %>
    siteElement.id = settings.urlParams.siteElementID
    siteElement.site.id = settings.urlParams.siteID
    siteElement.element_subtype = "traffic"
    siteElement.site.capabilities.custom_targeted_bars = true
    siteElement.site.capabilities.remove_branding = true

    this.responseText = siteElement

$.mockjax
  url: /^\/sites\/([\d]+)\/identities\/([\w]+)\.json$/
  urlParams: ['siteID', 'provider']
  contentType: 'text/json'
  response: (settings) ->
    if settings.urlParams.provider == "mailchimp"
      this.responseText = JSON.stringify({
        id: 1
        site_id: settings.urlParams.siteID
        lists: [{id: 1, name: "my cool list"}, {id: 2, name: "my other cool list"}]
      })
    else
      this.responseText = {}

$.mockjax
  url: /^\/sites\/([\d]+)\/contact_lists\/([\w]+)\.json$/
  urlParams: ['siteID', 'contactListID']
  contentType: 'text/json'
  response: (settings) ->
    this.responseText = JSON.stringify({
      id: settings.urlParams.contactListID
      site_id: settings.urlParams.siteID
      name: "Contact List Name"
      provider: "mailchimp"
      data:
        remote_id: "2"
        remote_name: "my other cool list"
    })

# Used in editor_targeting_test by @wootie
$.mockjax
  url: "http://localhost:3000/"
  status: 200
  responseText: {}

$.mockjax
  url: /sites\/\d+\/rules/
  status: 200
  response: {}
  responseText: {}
