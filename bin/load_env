#!/usr/bin/env ruby
require 'optparse'
require 'yaml'

env = ENV['RAILS_ENV'] || ENV['RACK_ENV'] || 'production'

options = { config_path: File.expand_path(File.dirname(__FILE__) + '/../config/application.yml')}
OptionParser.new do |opts|
  opts.on('-c', '--config CONFIG', 'Config file location') do |path|
    options[:config_path] = path
  end
end

config = YAML.load_file(options[:config_path])
config = config[env] if config.has_key?(env)

args = ARGV.dup
if args.include?('--') # drop args before --
  args = args[args.index('--') + 1, args.length]
end

config.each do |key, value|
  args.unshift("#{key.upcase}='#{value}'")
end

system(args.join(" "))
